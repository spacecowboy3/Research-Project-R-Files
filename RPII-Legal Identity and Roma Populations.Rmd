---
title: 'RPII: Legal Identity and Roma Populations in North Macedonia'
author: "Noah Plane"
date: "2024-06-12"
output: html_document
---

# Downloading package facilitating the importing of SPSS files into R

```{r}
if (!requireNamespace("haven", quietly = TRUE)) {
  install.packages("haven", repos = "http://cran.us.r-project.org")
}
if (!requireNamespace("dplyr", quietly = TRUE)) {
  install.packages("dplyr", repos = "http://cran.us.r-project.org")
}

library(haven)
library(dplyr)
```


# Loading UNICEF MICS North-Macedonia SPSS data form 2018-19 into R all data that is specifically about the Roma population gets the indicator .r

```{r}
data_directory <- "~/Desktop/Research Project R Files/Data/Republic of North Macedonia (Roma Settlements) MICS6 SPSS Datasets"
sav_files <- list.files(data_directory, pattern = "\\.sav$", full.names = TRUE)
datasets <- list()
for (file in sav_files) {
  dataset_name <- paste0(tools::file_path_sans_ext(basename(file)), "r") 
  datasets[[dataset_name]] <- read_sav(file)
}

names(datasets)

data_directory_2 <- "~/Desktop/Research Project R Files/Data/Republic of North Macedonia MICS6 SPSS Datasets"
sav_files_2 <- list.files(data_directory_2, pattern = "\\.sav$", full.names = TRUE)
for (file in sav_files_2) {
  dataset_name <- tools::file_path_sans_ext(basename(file)) 
  datasets[[dataset_name]] <- read_sav(file)
}
names(datasets)
```

# Assign each data-set to a separate variable in the global environment

```{r}
list2env(datasets, envir = .GlobalEnv)
ls()
```

Checking for the relevant data sets 
```{r}
str(datasets$hhr)
str(datasets$hlr)
str(datasets$wmr)
str(datasets$chr)

```


#Checking for if Hl1 needs to be recoded into LN 

```{r}
names(datasets$hlr)
```
#Sort datasets by key variables

```{r}
datasets$hhr <- datasets$hhr %>% arrange(HH1, HH2)
datasets$hlr <- datasets$hlr %>% arrange(HH1, HH2, LN)
datasets$wmr <- datasets$wmr %>% arrange(HH1, HH2, LN)
datasets$chr <- datasets$chr %>% arrange(HH1, HH2, LN)
datasets$chr <- datasets$bhr %>% arrange(HH1, HH2, LN)
datasets$chr <- datasets$fsr %>% arrange(HH1, HH2, LN)
```

#Merge datasets
```{r}
merged_data <- left_join(datasets$hlr, datasets$hhr, by = c("HH1", "HH2"))
merged_data <- left_join(merged_data, datasets$wmr, by = c("HH1", "HH2", "LN"))
merged_data <- left_join(merged_data, datasets$chr, by = c("HH1", "HH2", "LN"))
merged_data <- left_join(merged_data, datasets$bhr, by = c("HH1", "HH2", "LN"))
merged_data <- left_join(merged_data, datasets$fsr, by = c("HH1", "HH2", "LN"))
```


# Adding relevand variables for analyis
```{r}
hhr_selected <- datasets$hhr %>%
  select(HH1, HH2, HH10) # Household Wealth Index

hlr_selected <- datasets$hlr %>%
  select(HH1, HH2, LN, HH6) # Urban/Rural Residence

wmr_selected <- datasets$wmr %>%
  select(HH1, HH2, LN, WM9, WM1) # Mother Disability Status and Mother's Education Level

chr_selected <- datasets$chr %>%
  select(HH1, HH2, LN, BR2, WS2, UB9) # Birth Registration, Child Disability Status, and Health Insurance Coverage

```





# Check merged dataset

```{r}
str(merged_data)
```

# Save merged dataset for better sharing and in the case of crash
```{r}
write.csv(merged_data, "merged_data.csv", row.names = FALSE)
```






# Start of analysis
# Summary statistics
```{r}
summary(merged_data)
```

